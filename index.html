<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>Salesforce Knowledge Import Tool - Free CSV to Salesforce Converter</title>
    <meta name="description" content="Free online tool to convert CSV files into Salesforce Knowledge import format. Extract rich text, map lookups, transform data categories, and generate ZIP files ready for Salesforce import. No installation required.">
    <meta name="keywords" content="Salesforce, Knowledge, Import, CSV, Converter, Tool, Article Import, Data Category, Salesforce Knowledge Base, Free Tool, Salesforce Admin, Knowledge Article, Bulk Import, Salesforce Migration">
    <meta name="author" content="Salesforce Knowledge Tool">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://abhiram96.github.io/salesforce-knowledge-import-tool/">
    
    <!-- Open Graph for Social Sharing -->
    <meta property="og:title" content="Salesforce Knowledge Import Tool - Free CSV Converter">
    <meta property="og:description" content="Convert CSV files into Salesforce Knowledge import format with rich text extraction, lookup mapping, and data category transformation. 100% free and client-side processing.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://abhiram96.github.io/salesforce-knowledge-import-tool/">
    <meta property="og:site_name" content="Salesforce Knowledge Import Tool">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Salesforce Knowledge Import Tool">
    <meta name="twitter:description" content="Free tool to convert CSV to Salesforce Knowledge import format. Rich text extraction, lookup mapping, and more.">
    
    <!-- Libraries -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        // Lucide icons as inline SVG components
        const Upload = ({size = 24, ...props}) => (
          <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="17 8 12 3 7 8"></polyline>
            <line x1="12" y1="3" x2="12" y2="15"></line>
          </svg>
        );
        
        const FileText = ({size = 24, ...props}) => (
          <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="16" y1="13" x2="8" y2="13"></line>
            <line x1="16" y1="17" x2="8" y2="17"></line>
            <polyline points="10 9 9 9 8 9"></polyline>
          </svg>
        );
        
        const Settings = ({size = 24, ...props}) => (
          <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M12 1v6m0 6v6m-9-9h6m6 0h6"></path>
          </svg>
        );
        
        const Download = ({size = 24, ...props}) => (
          <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
        );
        
        const ChevronRight = ({size = 24, ...props}) => (
          <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        );
        
        const ChevronLeft = ({size = 24, ...props}) => (
          <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        );
        
        const Check = ({size = 24, ...props}) => (
          <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
        );
        
        const AlertCircle = ({size = 24, ...props}) => (
          <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
          </svg>
        );
        
        const Plus = ({size = 24, ...props}) => (
          <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
        );
        
        const X = ({size = 24, ...props}) => (
          <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        );

        const SalesforceKnowledgeImportTool = () => {
          const [step, setStep] = React.useState(1);
          const [csvData, setCsvData] = React.useState(null);
          const [csvHeaders, setCsvHeaders] = React.useState([]);
          const [richTextColumns, setRichTextColumns] = React.useState([]);
          const [lookupFields, setLookupFields] = React.useState([]);
          const [dataCategoryGroups, setDataCategoryGroups] = React.useState([]);
          const [dataCategoryConfig, setDataCategoryConfig] = React.useState({ selectionColumn: '' });
          const [outputSettings, setOutputSettings] = React.useState({
            csvEncoding: 'UTF-8',
            csvSeparator: ',',
            htmlEncoding: 'UTF-8',
            dateFormat: 'yyyy-MM-dd',
            outputFilename: 'PreppedData.csv'
          });
          const fileInputRef = React.useRef(null);

          const steps = [
            { number: 1, title: 'Upload CSV', icon: Upload },
            { number: 2, title: 'Map Columns', icon: Settings },
            { number: 3, title: 'Rich Text', icon: FileText },
            { number: 4, title: 'Lookups', icon: Settings },
            { number: 5, title: 'Categories', icon: Settings },
            { number: 6, title: 'Generate', icon: Download }
          ];

          const parseDataCategorySelections = (selectionsText) => {
            if (!selectionsText) return {};
            const categoryMap = {};
            try {
              const recordsMatch = selectionsText.match(/records=\[(.*?)\]/s);
              if (!recordsMatch) return {};
              const recordsText = recordsMatch[1];
              const records = recordsText.split(/\},\s*\{attributes=/);
              records.forEach(record => {
                const groupMatch = record.match(/DataCategoryGroupName=([^,}\s]+)/);
                const categoryMatch = record.match(/DataCategoryName=([^,}\s]+)/);
                if (groupMatch && categoryMatch) {
                  const groupName = groupMatch[1].trim();
                  const categoryName = categoryMatch[1].trim();
                  if (!categoryMap[groupName]) categoryMap[groupName] = [];
                  categoryMap[groupName].push(categoryName);
                }
              });
              Object.keys(categoryMap).forEach(group => {
                categoryMap[group] = categoryMap[group].join('+');
              });
            } catch (error) {
              console.error('Error parsing data category selections:', error);
            }
            return categoryMap;
          };

          const handleCSVUpload = (event) => {
            const file = event.target.files[0];
            if (file) {
              Papa.parse(file, {
                header: true,
                skipEmptyLines: true,
                complete: (results) => {
                  setCsvData(results.data);
                  setCsvHeaders(results.meta.fields);
                  const detectedRichText = results.meta.fields.filter(h => 
                    h.toLowerCase().includes('answer') || h.toLowerCase().includes('external_content')
                  );
                  setRichTextColumns(detectedRichText);
                  const dataCatCol = results.meta.fields.find(h => 
                    h.toLowerCase().includes('datacategoryselection') || h.toLowerCase().includes('datacategory')
                  );
                  if (dataCatCol) {
                    setDataCategoryConfig({ selectionColumn: dataCatCol });
                    const allGroups = new Set();
                    results.data.forEach(row => {
                      const selections = row[dataCatCol];
                      if (selections) {
                        const parsed = parseDataCategorySelections(selections);
                        Object.keys(parsed).forEach(group => allGroups.add(group));
                      }
                    });
                    setDataCategoryGroups(Array.from(allGroups).map(group => ({
                      groupName: group,
                      columnName: `datacategorygroup.${group}`
                    })));
                  }
                  setStep(2);
                },
                error: (error) => alert('Error parsing CSV: ' + error.message)
              });
            }
          };

          const toggleRichTextColumn = (column) => {
            setRichTextColumns(prev => 
              prev.includes(column) ? prev.filter(c => c !== column) : [...prev, column]
            );
          };

          const addLookupField = () => {
            setLookupFields(prev => [...prev, { 
              fieldName: '', lookupColumn: '', idColumn: '', referenceData: null 
            }]);
          };

          const updateLookupField = (index, field, value) => {
            setLookupFields(prev => {
              const updated = [...prev];
              updated[index][field] = value;
              return updated;
            });
          };

          const removeLookupField = (index) => {
            setLookupFields(prev => prev.filter((_, i) => i !== index));
          };

          const handleLookupReferenceUpload = (index, event) => {
            const file = event.target.files[0];
            if (file) {
              Papa.parse(file, {
                header: true,
                skipEmptyLines: true,
                complete: (results) => {
                  updateLookupField(index, 'referenceData', results.data);
                  if (!lookupFields[index].lookupColumn && results.meta.fields.length > 0) {
                    updateLookupField(index, 'lookupColumn', results.meta.fields[0]);
                  }
                  if (!lookupFields[index].idColumn && results.meta.fields.length > 1) {
                    updateLookupField(index, 'idColumn', results.meta.fields[1]);
                  }
                }
              });
            }
          };

          const crc32 = (data) => {
            const table = [];
            for (let i = 0; i < 256; i++) {
              let c = i;
              for (let j = 0; j < 8; j++) c = (c & 1) ? (0xEDB88320 ^ (c >>> 1)) : (c >>> 1);
              table[i] = c;
            }
            let crc = 0 ^ (-1);
            for (let i = 0; i < data.length; i++) {
              crc = (crc >>> 8) ^ table[(crc ^ data[i]) & 0xFF];
            }
            return (crc ^ (-1)) >>> 0;
          };

          const createZipBlob = (files) => {
            const encoder = new TextEncoder();
            const localHeaders = [];
            const centralHeaders = [];
            let offset = 0;

            files.forEach(({ filename, content }) => {
              const filenameBytes = encoder.encode(filename);
              const contentBytes = typeof content === 'string' ? encoder.encode(content) : content;
              const crc = crc32(contentBytes);
              
              const localHeader = new Uint8Array(30 + filenameBytes.length);
              const lhView = new DataView(localHeader.buffer);
              lhView.setUint32(0, 0x04034b50, true);
              lhView.setUint16(4, 20, true);
              lhView.setUint16(6, 0, true);
              lhView.setUint16(8, 0, true);
              lhView.setUint16(10, 0, true);
              lhView.setUint16(12, 0, true);
              lhView.setUint32(14, crc, true);
              lhView.setUint32(18, contentBytes.length, true);
              lhView.setUint32(22, contentBytes.length, true);
              lhView.setUint16(26, filenameBytes.length, true);
              lhView.setUint16(28, 0, true);
              localHeader.set(filenameBytes, 30);
              
              localHeaders.push({
                header: localHeader, content: contentBytes, filename: filenameBytes,
                crc: crc, size: contentBytes.length, offset: offset
              });
              offset += localHeader.length + contentBytes.length;
            });

            const centralDirStart = offset;
            localHeaders.forEach(({ filename, crc, size, offset: localOffset }) => {
              const cdHeader = new Uint8Array(46 + filename.length);
              const cdView = new DataView(cdHeader.buffer);
              cdView.setUint32(0, 0x02014b50, true);
              cdView.setUint16(4, 20, true);
              cdView.setUint16(6, 20, true);
              cdView.setUint16(8, 0, true);
              cdView.setUint16(10, 0, true);
              cdView.setUint16(12, 0, true);
              cdView.setUint16(14, 0, true);
              cdView.setUint32(16, crc, true);
              cdView.setUint32(20, size, true);
              cdView.setUint32(24, size, true);
              cdView.setUint16(28, filename.length, true);
              cdView.setUint16(30, 0, true);
              cdView.setUint16(32, 0, true);
              cdView.setUint16(34, 0, true);
              cdView.setUint16(36, 0, true);
              cdView.setUint32(38, 0, true);
              cdView.setUint32(42, localOffset, true);
              cdHeader.set(filename, 46);
              centralHeaders.push(cdHeader);
              offset += cdHeader.length;
            });

            const centralDirSize = offset - centralDirStart;
            const eocd = new Uint8Array(22);
            const eocdView = new DataView(eocd.buffer);
            eocdView.setUint32(0, 0x06054b50, true);
            eocdView.setUint16(4, 0, true);
            eocdView.setUint16(6, 0, true);
            eocdView.setUint16(8, files.length, true);
            eocdView.setUint16(10, files.length, true);
            eocdView.setUint32(12, centralDirSize, true);
            eocdView.setUint32(16, centralDirStart, true);
            eocdView.setUint16(20, 0, true);

            const parts = [];
            localHeaders.forEach(({ header, content }) => {
              parts.push(header);
              parts.push(content);
            });
            centralHeaders.forEach(header => parts.push(header));
            parts.push(eocd);
            return new Blob(parts, { type: 'application/zip' });
          };

          const generateZipFile = async () => {
            try {
              const files = [];
              const processedData = csvData.map((row, index) => {
                const rowNumber = index + 2;
                const newRow = { ...row };
                
                lookupFields.forEach(lookup => {
                  if (lookup.fieldName && lookup.referenceData && lookup.lookupColumn && lookup.idColumn) {
                    const lookupValue = row[lookup.fieldName];
                    if (lookupValue) {
                      const match = lookup.referenceData.find(ref => 
                        ref[lookup.lookupColumn] && 
                        ref[lookup.lookupColumn].toString().trim() === lookupValue.toString().trim()
                      );
                      if (match && match[lookup.idColumn]) {
                        newRow[lookup.fieldName] = match[lookup.idColumn];
                      }
                    }
                  }
                });
                
                richTextColumns.forEach(column => {
                  if (row[column]) {
                    const isExternal = column.toLowerCase().includes('external');
                    const fileName = isExternal 
                      ? `extfiles/FileExt${rowNumber}.html`
                      : `files/File${rowNumber}.html`;
                    files.push({ filename: fileName, content: row[column] });
                    newRow[column] = fileName;
                  }
                });
                
                if (dataCategoryConfig.selectionColumn) {
                  const selectionsText = row[dataCategoryConfig.selectionColumn];
                  if (selectionsText) {
                    const categoryMap = parseDataCategorySelections(selectionsText);
                    delete newRow[dataCategoryConfig.selectionColumn];
                    dataCategoryGroups.forEach(group => {
                      newRow[group.columnName] = categoryMap[group.groupName] || '';
                    });
                  } else {
                    dataCategoryGroups.forEach(group => {
                      newRow[group.columnName] = '';
                    });
                  }
                }
                return newRow;
              });
              
              const csv = Papa.unparse(processedData, {
                header: true,
                delimiter: outputSettings.csvSeparator
              });
              
              const propertiesContent = `CSVEncoding=${outputSettings.csvEncoding}
DefaultHTMLEncoding=${outputSettings.htmlEncoding}
RTAEncoding=${outputSettings.htmlEncoding}
CSVSeparator=${outputSettings.csvSeparator}
#DateFormat=${outputSettings.dateFormat}`;
              
              files.unshift(
                { filename: 'properties.properties', content: propertiesContent },
                { filename: outputSettings.outputFilename, content: csv }
              );
              
              const zipBlob = createZipBlob(files);
              const url = URL.createObjectURL(zipBlob);
              const a = document.createElement('a');
              a.href = url;
              a.download = 'salesforce-knowledge-import.zip';
              document.body.appendChild(a);
              a.click();
              document.body.removeChild(a);
              URL.revokeObjectURL(url);
              
              alert(`Successfully created ZIP with ${files.length} files!`);
            } catch (error) {
              alert('Error creating ZIP: ' + error.message);
              console.error(error);
            }
          };

          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
              <div className="max-w-6xl mx-auto">
                <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                  <h1 className="text-3xl font-bold text-gray-800 mb-2">
                    Salesforce Knowledge Import Tool
                  </h1>
                  <p className="text-gray-600">
                    Convert your CSV data into Salesforce Knowledge import-ready format
                  </p>
                </div>

                <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                  <div className="flex items-center justify-between overflow-x-auto">
                    {steps.map((s, index) => {
                      const StepIcon = s.icon;
                      const isActive = step === s.number;
                      const isCompleted = step > s.number;
                      
                      return (
                        <React.Fragment key={s.number}>
                          <div className="flex flex-col items-center min-w-fit">
                            <div className={`w-12 h-12 rounded-full flex items-center justify-center ${
                              isCompleted ? 'bg-green-500 text-white' :
                              isActive ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-500'
                            }`}>
                              {isCompleted ? <Check size={24} /> : <StepIcon size={24} />}
                            </div>
                            <span className={`mt-2 text-sm font-medium ${
                              isActive ? 'text-indigo-600' : 'text-gray-500'
                            }`}>
                              {s.title}
                            </span>
                          </div>
                          {index < steps.length - 1 && (
                            <div className={`flex-1 h-1 mx-4 ${
                              step > s.number ? 'bg-green-500' : 'bg-gray-200'
                            }`} />
                          )}
                        </React.Fragment>
                      );
                    })}
                  </div>
                </div>

                <div className="bg-white rounded-lg shadow-lg p-6" style={{minHeight: '400px'}}>
                  {step === 1 && (
                    <div className="space-y-6">
                      <h2 className="text-2xl font-bold text-gray-800">Upload Your CSV File</h2>
                      <div className="border-2 border-dashed border-gray-300 rounded-lg p-12 text-center hover:border-indigo-500 transition-colors cursor-pointer"
                           onClick={() => fileInputRef.current?.click()}>
                        <Upload className="mx-auto h-12 w-12 text-gray-400 mb-4" />
                        <p className="text-lg text-gray-600 mb-2">
                          Click to select your CSV file
                        </p>
                        <input
                          ref={fileInputRef}
                          type="file"
                          accept=".csv"
                          onChange={handleCSVUpload}
                          style={{display: 'none'}}
                        />
                      </div>
                    </div>
                  )}

                  {step === 2 && csvData && (
                    <div className="space-y-6">
                      <h2 className="text-2xl font-bold text-gray-800">Review Detected Columns</h2>
                      <p className="text-gray-600">
                        We've detected {csvHeaders.length} columns. {richTextColumns.length} rich text columns found.
                      </p>
                      <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                        <Check className="inline h-5 w-5 text-green-600 mr-2" />
                        <span className="font-semibold text-green-900">Ready to proceed!</span>
                      </div>
                    </div>
                  )}

                  {step === 3 && (
                    <div className="space-y-6">
                      <h2 className="text-2xl font-bold text-gray-800">Select Rich Text Columns</h2>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {csvHeaders.map((header) => (
                          <label key={header} className={`flex items-center p-4 border-2 rounded-lg cursor-pointer ${
                            richTextColumns.includes(header) ? 'border-indigo-500 bg-indigo-50' : 'border-gray-200'
                          }`}>
                            <input
                              type="checkbox"
                              checked={richTextColumns.includes(header)}
                              onChange={() => toggleRichTextColumn(header)}
                              className="h-5 w-5 text-indigo-600 rounded mr-3"
                            />
                            <div className="font-medium text-gray-900">{header}</div>
                          </label>
                        ))}
                      </div>
                    </div>
                  )}

                  {step === 4 && (
                    <div className="space-y-6">
                      <h2 className="text-2xl font-bold text-gray-800">Configure Lookup Fields</h2>
                      {lookupFields.length === 0 && (
                        <div className="text-center py-8">
                          <p className="text-gray-500">No lookup fields configured.</p>
                        </div>
                      )}
                      {lookupFields.map((lookup, index) => (
                        <div key={index} className="border-2 border-gray-300 rounded-lg p-4 space-y-4">
                          <div className="grid grid-cols-3 gap-4">
                            <select value={lookup.fieldName} onChange={(e) => updateLookupField(index, 'fieldName', e.target.value)}
                                    className="px-3 py-2 border border-gray-300 rounded-md">
                              <option value="">Select field...</option>
                              {csvHeaders.map(h => <option key={h} value={h}>{h}</option>)}
                            </select>
                            <input type="file" accept=".csv" onChange={(e) => handleLookupReferenceUpload(index, e)} className="text-sm" />
                            <button onClick={() => removeLookupField(index)} className="px-4 py-2 text-red-600 hover:bg-red-50 rounded border border-red-300">
                              Remove
                            </button>
                          </div>
                          {lookup.referenceData && (
                            <div className="grid grid-cols-2 gap-4 pl-4 border-l-2 border-indigo-300">
                              <select value={lookup.lookupColumn} onChange={(e) => updateLookupField(index, 'lookupColumn', e.target.value)}
                                      className="px-3 py-2 border border-gray-300 rounded-md text-sm">
                                <option value="">Lookup column...</option>
                                {lookup.referenceData.length > 0 && Object.keys(lookup.referenceData[0]).map(col => 
                                  <option key={col} value={col}>{col}</option>
                                )}
                              </select>
                              <select value={lookup.idColumn} onChange={(e) => updateLookupField(index, 'idColumn', e.target.value)}
                                      className="px-3 py-2 border border-gray-300 rounded-md text-sm">
                                <option value="">ID column...</option>
                                {lookup.referenceData.length > 0 && Object.keys(lookup.referenceData[0]).map(col => 
                                  <option key={col} value={col}>{col}</option>
                                )}
                              </select>
                            </div>
                          )}
                        </div>
                      ))}
                      <button onClick={addLookupField} className="w-full flex items-center justify-center gap-2 px-4 py-2 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-indigo-500">
                        <Plus size={20} /> Add Lookup Field
                      </button>
                    </div>
                  )}

                  {step === 5 && (
                    <div className="space-y-6">
                      <h2 className="text-2xl font-bold text-gray-800">Configure Data Categories</h2>
                      <select value={dataCategoryConfig.selectionColumn} 
                              onChange={(e) => {
                                setDataCategoryConfig({ selectionColumn: e.target.value });
                                if (e.target.value) {
                                  const allGroups = new Set();
                                  csvData.forEach(row => {
                                    const selections = row[e.target.value];
                                    if (selections) {
                                      const parsed = parseDataCategorySelections(selections);
                                      Object.keys(parsed).forEach(group => allGroups.add(group));
                                    }
                                  });
                                  setDataCategoryGroups(Array.from(allGroups).map(group => ({
                                    groupName: group,
                                    columnName: `datacategorygroup.${group}`
                                  })));
                                }
                              }}
                              className="w-full px-3 py-2 border border-gray-300 rounded-md">
                        <option value="">Select DataCategorySelections column...</option>
                        {csvHeaders.map(header => <option key={header} value={header}>{header}</option>)}
                      </select>
                      {dataCategoryGroups.length > 0 && (
                        <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                          <p className="font-semibold text-green-900">Detected {dataCategoryGroups.length} groups:</p>
                          <div className="mt-2 space-y-1">
                            {dataCategoryGroups.map((group, i) => (
                              <div key={i} className="text-sm font-mono text-indigo-600">{group.columnName}</div>
                            ))}
                          </div>
                        </div>
                      )}
                    </div>
                  )}

                  {step === 6 && (
                    <div className="space-y-6">
                      <h2 className="text-2xl font-bold text-gray-800">Generate Import Package</h2>
                      <div className="grid grid-cols-2 gap-6">
                        <div className="bg-gray-50 rounded-lg p-4">
                          <h3 className="font-semibold text-gray-800 mb-3">Summary</h3>
                          <dl className="space-y-2 text-sm">
                            <div className="flex justify-between">
                              <dt className="text-gray-600">Total Rows:</dt>
                              <dd className="font-medium">{csvData?.length || 0}</dd>
                            </div>
                            <div className="flex justify-between">
                              <dt className="text-gray-600">Rich Text Columns:</dt>
                              <dd className="font-medium">{richTextColumns.length}</dd>
                            </div>
                            <div className="flex justify-between">
                              <dt className="text-gray-600">Lookup Fields:</dt>
                              <dd className="font-medium">{lookupFields.length}</dd>
                            </div>
                            <div className="flex justify-between">
                              <dt className="text-gray-600">Data Categories:</dt>
                              <dd className="font-medium">{dataCategoryGroups.length}</dd>
                            </div>
                          </dl>
                        </div>
                        <div className="bg-gray-50 rounded-lg p-4">
                          <h3 className="font-semibold text-gray-800 mb-3">Output Settings</h3>
                          <div className="space-y-3">
                            <div>
                              <label className="block text-xs text-gray-600 mb-1">CSV Encoding</label>
                              <select value={outputSettings.csvEncoding} onChange={(e) => setOutputSettings(p => ({ ...p, csvEncoding: e.target.value }))}
                                      className="w-full px-2 py-1 text-sm border border-gray-300 rounded">
                                <option>UTF-8</option>
                                <option>ISO-8859-1</option>
                              </select>
                            </div>
                            <div>
                              <label className="block text-xs text-gray-600 mb-1">Output Filename</label>
                              <input type="text" value={outputSettings.outputFilename} onChange={(e) => setOutputSettings(p => ({ ...p, outputFilename: e.target.value }))}
                                     className="w-full px-2 py-1 text-sm border border-gray-300 rounded" />
                            </div>
                          </div>
                        </div>
                      </div>
                      <button onClick={generateZipFile} className="w-full flex items-center justify-center gap-2 px-6 py-4 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-semibold text-lg">
                        <Download size={24} /> Generate & Download ZIP
                      </button>
                    </div>
                  )}

                  <div className="flex justify-between mt-8 pt-6 border-t border-gray-200">
                    <button onClick={() => setStep(Math.max(1, step - 1))} disabled={step === 1}
                            className="flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                      <ChevronLeft size={20} /> Previous
                    </button>
                    {step < 6 && (
                      <button onClick={() => setStep(Math.min(6, step + 1))} disabled={!csvData}
                              className="flex items-center gap-2 px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed">
                        Next <ChevronRight size={20} />
                      </button>
                    )}
                  </div>
                </div>
              </div>
            </div>
          );
        };

        // Wait for all libraries to load
        if (typeof React !== 'undefined' && typeof ReactDOM !== 'undefined' && typeof Papa !== 'undefined') {
          const root = ReactDOM.createRoot(document.getElementById('root'));
          root.render(React.createElement(SalesforceKnowledgeImportTool));
        } else {
          console.error('Libraries not loaded properly');
          document.getElementById('root').innerHTML = '<div style="padding: 20px; color: red;">Error: Required libraries failed to load. Please check your internet connection and refresh the page.</div>';
        }
    </script>
</body>
</html>
